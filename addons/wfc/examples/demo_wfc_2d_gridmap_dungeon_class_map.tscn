[gd_scene load_steps=12 format=3 uid="uid://hdrh51fuavnr"]

[ext_resource type="MeshLibrary" uid="uid://310b3aggjq0d" path="res://addons/wfc/examples/assets/kenny-nature-kit/meshlib.meshlib" id="1_5g1ur"]
[ext_resource type="Script" path="res://addons/wfc/nodes/generator_2d.gd" id="2_ygcwd"]
[ext_resource type="Script" path="res://addons/wfc/problems/2d/rules_2d.gd" id="5_qumw0"]
[ext_resource type="PackedScene" uid="uid://dheyfh3bip6t7" path="res://addons/wfc/examples/helpers/3d_controls.tscn" id="6_21eh3"]
[ext_resource type="Script" path="res://addons/wfc/solver/solver_settings.gd" id="6_uls1f"]
[ext_resource type="Script" path="res://addons/wfc/problems/2d/preconditions/precondition_2d_dungeon_settings.gd" id="7_gllx8"]
[ext_resource type="PackedScene" uid="uid://dt2nffs32s7o1" path="res://addons/wfc/examples/helpers/progress_indicator.tscn" id="8_rvqav"]

[sub_resource type="GDScript" id="GDScript_f3n0e"]
script/source = "extends Node3D

@export
var stress_test: bool = false

func _ready():
	$sample.hide()
	$class_map.hide()
	$target.show()
	$generator.start()


func _on_generator_done():
	if stress_test:
		$target.clear()
		$generator.reset()
		$generator.start()
"

[sub_resource type="Resource" id="Resource_3csuy"]
script = ExtResource("5_qumw0")
complete_matrices = true
axes = Array[Vector2i]([Vector2i(0, 1), Vector2i(1, 0)])
axis_matrices = Array[Resource("res://addons/wfc/utils/bitmatrix.gd")]([])
probabilities = []
probabilities_enabled = true

[sub_resource type="Resource" id="Resource_mtj5f"]
script = ExtResource("6_uls1f")
allow_backtracking = true
require_backtracking = false
backtracking_limit = -1

[sub_resource type="Resource" id="Resource_7i8ha"]
script = ExtResource("7_gllx8")
wall_border_size = Vector2i(1, 2)
free_gap = Vector2i(2, 2)
room_half_size_base = Vector2i(2, 2)
room_half_size_variation = Vector2i(2, 2)
room_probability = 0.5
road_len_base = 15
road_len_variation = 5
fork_probability = 0.5
full_fork_probability = 0.5
passable_area_ratio = 0.1
iterations_limit = 1000
road_class = "wfc_dungeon_road"
wall_class = "wfc_dungeon_wall"
classes_map = NodePath("../class_map")

[node name="test_gm" type="Node3D"]
script = SubResource("GDScript_f3n0e")

[node name="sample" type="GridMap" parent="."]
visible = false
mesh_library = ExtResource("1_5g1ur")
cell_size = Vector3(1, 1, 1)
data = {
"cells": PackedInt32Array(0, 6, 1441792, 0, 5, 1441792, 1, 5, 1441792, 1, 6, 1441792, 3, 6, 655360, 3, 5, 655360, 4, 5, 655360, 4, 6, 655360, 6, 6, 1048576, 6, 5, 1048576, 7, 5, 1048576, 7, 6, 1048576, 9, 6, 0, 9, 5, 0, 10, 5, 0, 10, 6, 0, 14, 6, 1048576, 13, 6, 0, 14, 7, 0, 15, 6, 0, 14, 5, 0, 18, 6, 0, 17, 6, 1441792, 18, 7, 1441792, 19, 6, 1441792, 18, 5, 1441792, 22, 6, 1441792, 21, 6, 655360, 22, 7, 655360, 23, 6, 655360, 22, 5, 655360, 26, 6, 1048576, 25, 6, 0, 26, 7, 0, 27, 6, 0, 26, 5, 0, 0, 65533, 8, 0, 65532, 8, 1, 65532, 8, 1, 65533, 8, 3, 65533, 1441800, 3, 65532, 1441800, 4, 65532, 1441800, 4, 65533, 1441800, 6, 65533, 655368, 6, 65532, 655368, 7, 65532, 655368, 7, 65533, 655368, 9, 65533, 1048584, 9, 65532, 1048584, 10, 65532, 1048584, 10, 65533, 1048584, 14, 65533, 1048584, 13, 65533, 8, 14, 65534, 8, 15, 65533, 8, 14, 65532, 8, 18, 65533, 8, 17, 65533, 1441800, 18, 65534, 1441800, 18, 65532, 1441800, 19, 65533, 1441800, 22, 65533, 1441800, 21, 65533, 655368, 22, 65534, 655368, 22, 65532, 655368, 23, 65533, 655368, 26, 65533, 655368, 25, 65533, 1048584, 26, 65534, 1048584, 26, 65532, 1048584, 27, 65533, 1048584, 0, 65524, 1048584, 1, 65524, 1048586, 65535, 65524, 1441802, 0, 65523, 655370, 0, 65525, 10, 0, 65526, 0, 2, 65524, 0, 0, 65522, 0, 65534, 65524, 0, 4, 65526, 10, 5, 65526, 10, 4, 65524, 1441802, 4, 65523, 1441802, 6, 65524, 1048586, 6, 65523, 1048586, 4, 65521, 655370, 5, 65521, 655370, 11, 65522, 655363, 11, 65524, 1441795, 13, 65524, 3, 13, 65522, 1048579, 12, 65524, 10, 11, 65523, 1441802, 12, 65522, 655370, 13, 65523, 1048586, 14, 65522, 1048576, 13, 65521, 1048576, 11, 65521, 1048576, 10, 65522, 1048576, 10, 65524, 1048576, 11, 65525, 1048576, 13, 65525, 1048576, 14, 65524, 1048576, 22, 65521, 11, 20, 65523, 1048587, 22, 65525, 655371, 24, 65523, 1441803, 22, 65524, 1441800, 22, 65522, 1441800, 21, 65523, 1441800, 23, 65523, 1441800, 20, 65524, 1441802, 20, 65522, 1441802, 21, 65521, 655370, 23, 65521, 655370, 24, 65522, 1048586, 24, 65524, 1048586, 23, 65525, 10, 21, 65525, 10, 22, 65520, 13, 22, 65526, 13, 19, 65523, 1441805, 25, 65523, 1441805, 29, 65526, 1441805, 30, 65526, 1441805, 29, 65524, 1048589, 30, 65524, 1048589, 32, 65526, 1048589, 33, 65526, 1441805, 34, 65526, 1048589, 29, 65521, 13, 29, 65520, 13, 31, 65521, 655373, 31, 65520, 655373, 33, 65522, 655373, 33, 65521, 13, 33, 65520, 655373, 32, 65520, 655360, 32, 65521, 655360, 32, 65522, 655360, 34, 65522, 655360, 34, 65521, 655360, 34, 65520, 655360, 30, 65521, 655360, 30, 65520, 655360, 28, 65521, 655360, 28, 65520, 655360, 29, 65525, 655360, 30, 65525, 655360, 29, 65523, 655360, 30, 65523, 655360, 29, 65527, 655360, 30, 65527, 655360, 32, 65527, 655360, 33, 65527, 655360, 34, 65527, 655360, 34, 65525, 655360, 33, 65525, 655360, 32, 65525, 655360, 0, 65512, 655369, 0, 65510, 9, 0, 65505, 1441801, 2, 65505, 1048585, 1, 65505, 1048589, 65535, 65505, 1048589, 3, 65505, 1048589, 0, 65511, 13, 0, 65513, 13, 0, 65509, 13, 0, 65504, 0, 0, 65506, 0, 2, 65506, 0, 2, 65504, 0, 1, 65512, 0, 1, 65510, 0, 65535, 65510, 0, 65535, 65512, 0, 10, 65512, 1, 10, 65510, 1048577, 8, 65510, 655361, 8, 65512, 1441793, 9, 65512, 1441805, 9, 65510, 1441805, 8, 65511, 655373, 10, 65511, 655373, 11, 65510, 655360, 10, 65509, 655360, 7, 65510, 655360, 8, 65509, 655360, 7, 65512, 655360, 8, 65513, 655360, 10, 65513, 655360, 11, 65512, 655360, 16, 65512, 655365, 16, 65510, 1048581, 18, 65510, 5, 18, 65512, 1441797, 17, 65510, 1441805, 17, 65512, 1441805, 19, 65512, 1441805, 19, 65510, 1441805, 15, 65510, 1441805, 15, 65512, 1441805, 16, 65511, 655373, 18, 65511, 655373, 16, 65513, 655373, 18, 65513, 655373, 16, 65509, 655373, 18, 65509, 655373, 24, 65509, 655372, 26, 65509, 1048588, 26, 65511, 12, 24, 65511, 1441804, 25, 65511, 1441805, 25, 65509, 1441805, 26, 65510, 655373, 24, 65510, 655373, 24, 65512, 655373, 23, 65509, 1048589, 26, 65508, 13, 27, 65511, 1441805, 27, 65509, 1441792, 26, 65512, 1441792, 23, 65511, 1441792, 24, 65508, 1441792, 32, 65510, 1441797, 31, 65510, 1441799, 32, 65509, 655367, 33, 65510, 1048583, 32, 65511, 7, 32, 65506, 5, 32, 65507, 6, 31, 65506, 1441798, 32, 65505, 655366, 33, 65506, 1048582, 32, 65508, 1048576, 31, 65507, 1048576, 30, 65506, 1048576, 31, 65505, 1048576, 32, 65504, 1048576, 33, 65505, 1048576, 34, 65506, 1048576, 33, 65507, 1048576, 33, 65509, 1048576, 34, 65510, 1048576, 33, 65511, 1048576, 32, 65512, 1048576, 31, 65511, 1048576, 30, 65510, 1048576, 31, 65509, 1048576, 39, 65534, 1048598, 39, 65533, 1048598, 40, 65533, 1048598, 40, 65534, 1048598, 42, 65534, 22, 42, 65533, 22, 43, 65533, 22, 43, 65534, 22, 45, 65534, 1441814, 45, 65533, 1441814, 46, 65533, 1441814, 46, 65534, 1441814, 48, 65534, 655382, 48, 65533, 655382, 49, 65533, 655382, 49, 65534, 655382, 52, 65534, 655382, 51, 65534, 1048598, 52, 65535, 1048598, 53, 65534, 1048598, 52, 65533, 1048598, 56, 65534, 1048598, 55, 65534, 22, 56, 65535, 22, 56, 65533, 22, 57, 65534, 22, 60, 65534, 22, 59, 65534, 1441814, 60, 65535, 1441814, 61, 65534, 1441814, 60, 65533, 1441814, 64, 65534, 1441814, 63, 65534, 655382, 64, 65535, 655382, 65, 65534, 655382, 64, 65533, 655382, 48, 65524, 1048600, 48, 65523, 1048600, 46, 65524, 1441816, 46, 65523, 1441816, 46, 65521, 655384, 47, 65521, 655384, 46, 65526, 24, 47, 65526, 24, 43, 65523, 22, 43, 65524, 24, 42, 65523, 1441816, 43, 65522, 655384, 44, 65523, 1048600, 43, 65521, 1048576, 41, 65523, 1048576, 43, 65525, 1048576, 45, 65523, 1048576, 51, 65524, 1441816, 52, 65523, 655384, 53, 65524, 1048600, 52, 65525, 24, 53, 65525, 17, 51, 65525, 1441809, 51, 65523, 655377, 53, 65523, 1048593, 54, 65523, 1048576, 53, 65522, 1048576, 51, 65522, 1048576, 50, 65523, 1048576, 50, 65525, 1048576, 51, 65526, 1048576, 53, 65526, 1048576, 54, 65525, 1048576, 58, 65524, 655382, 59, 65523, 655382, 60, 65524, 655382, 59, 65525, 655382, 59, 65526, 655385, 57, 65524, 1048601, 59, 65522, 25, 61, 65524, 1441817, 57, 65525, 1441816, 57, 65523, 1441816, 58, 65522, 655384, 60, 65522, 655384, 61, 65523, 1048600, 61, 65525, 1048600, 60, 65526, 24, 58, 65526, 24, 59, 65521, 27, 59, 65527, 27, 62, 65524, 1441819, 56, 65524, 1441819, 64, 65529, 655387, 64, 65528, 655387, 66, 65529, 27, 66, 65528, 27, 64, 65524, 1441819, 65, 65524, 1441819, 64, 65522, 1048603, 65, 65522, 1048603, 67, 65524, 1048603, 68, 65524, 1441819, 69, 65524, 1048603, 68, 65529, 27, 68, 65528, 655387, 68, 65527, 27, 67, 65529, 0, 67, 65528, 0, 69, 65529, 0, 69, 65528, 0, 69, 65527, 0, 65, 65528, 0, 65, 65529, 0, 63, 65529, 0, 63, 65528, 0, 64, 65525, 0, 65, 65525, 0, 64, 65523, 0, 65, 65523, 0, 64, 65521, 0, 65, 65521, 0, 67, 65523, 0, 68, 65523, 0, 69, 65523, 0, 69, 65525, 0, 68, 65525, 0, 67, 65525, 0, 43, 65513, 23, 43, 65511, 655383, 44, 65506, 1048599, 46, 65506, 1441815, 45, 65506, 1441819, 43, 65506, 1441819, 47, 65506, 1441819, 43, 65512, 655387, 43, 65514, 655387, 43, 65510, 655387, 44, 65513, 655360, 44, 65511, 655360, 42, 65511, 655360, 42, 65513, 655360, 44, 65507, 655360, 46, 65507, 655360, 46, 65505, 655360, 44, 65505, 655360, 48, 65511, 655375, 50, 65511, 1048591, 50, 65513, 15, 48, 65513, 1441807, 49, 65513, 1441815, 49, 65511, 1441815, 50, 65512, 655383, 48, 65512, 655383, 47, 65511, 655360, 48, 65510, 655360, 50, 65510, 655360, 51, 65511, 655360, 51, 65513, 655360, 50, 65514, 655360, 48, 65514, 655360, 47, 65513, 655360, 54, 65513, 655379, 56, 65513, 655379, 56, 65511, 655379, 54, 65511, 655379, 54, 65512, 655383, 56, 65512, 655383, 56, 65514, 655383, 56, 65510, 655383, 54, 65510, 655383, 54, 65514, 655383, 53, 65513, 1048599, 53, 65511, 1048599, 57, 65511, 1048599, 57, 65513, 1048599, 55, 65513, 1048599, 55, 65511, 1048599, 60, 65513, 1441818, 60, 65511, 655386, 62, 65511, 1048602, 62, 65513, 26, 60, 65512, 23, 60, 65514, 23, 62, 65512, 23, 62, 65510, 23, 61, 65511, 1441815, 61, 65513, 1441815, 63, 65513, 1441815, 59, 65511, 1441815, 60, 65510, 1441792, 63, 65511, 1441792, 62, 65514, 1441792, 59, 65513, 1441792, 67, 65510, 1441811, 66, 65510, 1441813, 67, 65509, 655381, 68, 65510, 1048597, 67, 65511, 21, 67, 65512, 0, 66, 65511, 0, 65, 65510, 0, 66, 65509, 0, 67, 65508, 0, 68, 65509, 0, 69, 65510, 0, 68, 65511, 0, 36, 6, 1441820, 34, 6, 655388, 34, 4, 1048604, 36, 4, 28, 39, 6, 14, 39, 4, 1441806, 41, 4, 655374, 41, 6, 1048590, 40, 6, 1048576, 39, 5, 1048576, 39, 3, 1048576, 41, 3, 1048576, 41, 5, 1048576, 41, 7, 1048576, 39, 7, 1048576, 40, 4, 1048576, 38, 4, 1048576, 37, 4, 1048576, 37, 6, 1048576, 38, 6, 1048576, 42, 6, 1048576, 42, 4, 1048576, 36, 7, 1048576, 35, 6, 1048576, 36, 5, 1048576, 35, 4, 1048576, 34, 3, 1048576, 36, 3, 1048576, 33, 4, 1048576, 34, 5, 1048576, 33, 6, 1048576, 34, 7, 1048576, 11, 65503, 655364, 11, 65501, 1048580, 13, 65501, 4, 13, 65503, 1441796, 12, 65503, 1441800, 11, 65502, 1441800, 13, 65502, 1441800, 12, 65501, 1441800, 11, 65500, 1441802, 11, 65504, 1441802, 10, 65501, 655370, 14, 65501, 655370, 13, 65500, 1048586, 13, 65504, 1048586, 14, 65503, 10, 10, 65503, 10, 59, 65503, 18, 59, 65505, 1441810, 57, 65505, 655378, 57, 65503, 1048594, 59, 65504, 1048598, 58, 65505, 1048598, 57, 65504, 1048598, 58, 65503, 1048598, 59, 65506, 1048600, 59, 65502, 1048600, 56, 65505, 24, 60, 65505, 24, 57, 65502, 1441816, 57, 65506, 1441816, 60, 65503, 655384, 56, 65503, 655384)
}
metadata/_editor_floor_ = Vector3(0, 0, 0)

[node name="target" type="GridMap" parent="."]
mesh_library = ExtResource("1_5g1ur")
cell_size = Vector3(1, 1, 1)

[node name="class_map" type="GridMap" parent="."]
mesh_library = ExtResource("1_5g1ur")
cell_size = Vector3(1, 1, 1)
data = {
"cells": PackedInt32Array(0, 1, 655360, 1, 1, 1048576, 2, 1, 0, 3, 1, 1441792, 4, 1, 14, 5, 1, 1441806, 6, 1, 655374, 7, 1, 1048590, 8, 1, 1048591, 9, 1, 15, 10, 1, 1441807, 11, 1, 655375, 12, 1, 655376, 13, 1, 1048592, 14, 1, 16, 15, 1, 1441808, 16, 1, 1441809, 17, 1, 655377, 18, 1, 1048593, 19, 1, 17, 20, 1, 18, 21, 1, 1441810, 22, 1, 655378, 23, 1, 1048594, 24, 1, 1048595, 25, 1, 19, 26, 1, 1441811, 27, 1, 655379, 28, 1, 655380, 29, 1, 1048596, 30, 1, 20, 31, 1, 1441812, 32, 1, 1441813, 33, 1, 655381, 34, 1, 1048597, 35, 1, 21, 36, 1, 22, 37, 1, 1441814, 38, 1, 655382, 39, 1, 1048598, 40, 1, 1048599, 41, 1, 23, 43, 1, 655383, 44, 1, 655384, 45, 1, 1048600, 46, 1, 24, 47, 1, 1441816, 48, 1, 1441817, 49, 1, 655385, 50, 1, 1048601, 51, 1, 25, 52, 1, 26, 53, 1, 1441818, 54, 1, 655386, 55, 1, 1048602, 56, 1, 1048603, 57, 1, 27, 58, 1, 1441819, 59, 1, 655387, 60, 1, 655388, 61, 1, 1048604, 62, 1, 28, 63, 1, 1441820, 42, 1, 1441815, 0, 0, 1441796, 1, 0, 655364, 2, 0, 1048580, 3, 0, 4, 4, 0, 8, 5, 0, 1441800, 6, 0, 655368, 7, 0, 1048584, 8, 0, 1048587, 9, 0, 11, 10, 0, 1441803, 11, 0, 655371, 12, 0, 655365, 13, 0, 1048581, 14, 0, 5, 15, 0, 1441797)
}
metadata/_editor_floor_ = Vector3(0, 0, 0)

[node name="Label3D" type="Label3D" parent="class_map"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707107, -1.14557, 1.64524, 0)
text = "First row contains only passable tiles"

[node name="Label3D2" type="Label3D" parent="class_map"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707107, -1.14557, 0.645245, 1)
text = "Second row contains non-passable tiles"

[node name="generator" type="Node" parent="."]
script = ExtResource("2_ygcwd")
target = NodePath("../target")
rect = Rect2i(-50, -50, 100, 100)
rules = SubResource("Resource_3csuy")
positive_sample = NodePath("../sample")
solver_settings = SubResource("Resource_mtj5f")
precondition = SubResource("Resource_7i8ha")
render_intermediate_results = true

[node name="controls" parent="." instance=ExtResource("6_21eh3")]

[node name="progressIndicator" parent="." node_paths=PackedStringArray("generator") instance=ExtResource("8_rvqav")]
generator = NodePath("../generator")

[connection signal="done" from="generator" to="." method="_on_generator_done"]
